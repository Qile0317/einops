<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>basics • einops</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="basics">
<!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-04PWRW9V04"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-04PWRW9V04');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">einops</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/basics.html">basics</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Qile0317/einops/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>basics</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Qile0317/einops/blob/main/vignettes/basics.Rmd" class="external-link"><code>vignettes/basics.Rmd</code></a></small>
      <div class="d-none name"><code>basics.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Qile0317/einops" class="external-link">einops</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'einops'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     repeat</span></span></code></pre></div>
<div class="section level2">
<h2 id="load-a-batch-of-images-to-play-with">Load a batch of images to play with<a class="anchor" aria-label="anchor" href="#load-a-batch-of-images-to-play-with"></a>
</h2>
<p>Here we the einops example data, an <code>image_tensor</code> object
- a thin wrapper around a 3D and 4D <code><a href="https://rdrr.io/r/base/array.html" class="external-link">base::array</a></code>. The data 6
images of shape 96x96 with 3 color channels packed into tensor.</p>
<p>Note that we set the option <code>einops_row_major = TRUE</code>.
This is a global option that the package uses because native R arrays
are stored in column-major order, which also affects its indexing
behaviour to be completely different compared to python’s many row-major
tensors. Using it here will make the examples much more intuitive, as
the images will be indexed by batch, height, width, and color channels,
just like in many deep learning frameworks. This option is false by
default to preserve the original R behavior, and can be overridden
anytime by setting the <code>.row_major</code> argument.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>einops_row_major <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">ims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"einops_image"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">ims</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  6 96 96  3</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># display the first image (whole 4d tensor can't be rendered)</span></span>
<span><span class="va">ims</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-2-1.png" width="48"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># second image in a batch</span></span>
<span><span class="va">ims</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-3-1.png" width="48"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># rearrange, as the name suggests, rearranges elements</span></span>
<span><span class="co"># below we swapped height and width.</span></span>
<span><span class="co"># In other words, transposed first two axes (dimensions)</span></span>
<span><span class="fu"><a href="../reference/rearrange.html">rearrange</a></span><span class="op">(</span><span class="va">ims</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"h w c -&gt; w h c"</span><span class="op">)</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-4-1.png" width="48"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we could use more verbose names for axes, and result is the same:</span></span>
<span><span class="fu"><a href="../reference/rearrange.html">rearrange</a></span><span class="op">(</span><span class="va">ims</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"height width color -&gt; width height color"</span><span class="op">)</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-5-1.png" width="48"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># when you operate on same set of axes many times,</span></span>
<span><span class="co"># you usually come up with short names.</span></span>
<span><span class="co"># That's what we do throughout tutorial - we'll use b (for batch), h, w, and c</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="composition-of-axes">Composition of axes<a class="anchor" aria-label="anchor" href="#composition-of-axes"></a>
</h2>
<p>Transposition is very common and useful, but let’s move to other
capabilities provided by einops.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># einops allows seamlessly composing batch and height to a new height dimension</span></span>
<span><span class="co"># We just rendered all images by collapsing to 3d tensor!</span></span>
<span><span class="fu"><a href="../reference/rearrange.html">rearrange</a></span><span class="op">(</span><span class="va">ims</span>, <span class="st">"b h w c -&gt; (b h) w c"</span><span class="op">)</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-6-1.png" width="48"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># or compose a new dimension of batch and width</span></span>
<span><span class="fu"><a href="../reference/rearrange.html">rearrange</a></span><span class="op">(</span><span class="va">ims</span>, <span class="st">"b h w c -&gt; h (b w) c"</span><span class="op">)</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># resulting dimensions are computed very simply</span></span>
<span><span class="co"># length of newly composed axis is a product of components</span></span>
<span><span class="co"># [6, 96, 96, 3] -&gt; [96, (6 * 96), 3]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="fu"><a href="../reference/rearrange.html">rearrange</a></span><span class="op">(</span><span class="va">ims</span>, <span class="st">"b h w c -&gt; h (b w) c"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  96 576   3</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we can compose more than two axes.</span></span>
<span><span class="co"># let's flatten 4d array into 1d, resulting array has as many elements as the original</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="fu"><a href="../reference/rearrange.html">rearrange</a></span><span class="op">(</span><span class="va">ims</span>, <span class="st">"b h w c -&gt; (b h w c)"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 165888</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="decomposition-of-axis">Decomposition of axis<a class="anchor" aria-label="anchor" href="#decomposition-of-axis"></a>
</h2>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># decomposition is the inverse process - represent an axis as a combination of new axes</span></span>
<span><span class="co"># several decompositions possible, so b1=2 is to decompose 6 to b1=2 and b2=3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="fu"><a href="../reference/rearrange.html">rearrange</a></span><span class="op">(</span><span class="va">ims</span>, <span class="st">"(b1 b2) h w c -&gt; b1 b2 h w c "</span>, b1<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  2  3 96 96  3</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># finally, combine composition and decomposition:</span></span>
<span><span class="fu"><a href="../reference/rearrange.html">rearrange</a></span><span class="op">(</span><span class="va">ims</span>, <span class="st">"(b1 b2) h w c -&gt; (b1 h) (b2 w) c "</span>, b1<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># slightly different composition: b1 is merged with width, b2 with height</span></span>
<span><span class="co"># ... so letters are ordered by w then by h</span></span>
<span><span class="fu"><a href="../reference/rearrange.html">rearrange</a></span><span class="op">(</span><span class="va">ims</span>, <span class="st">"(b1 b2) h w c -&gt; (b2 h) (b1 w) c "</span>, b1<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># move part of width dimension to height.</span></span>
<span><span class="co"># we should call this width-to-height as image width shrunk by 2 and height doubled.</span></span>
<span><span class="co"># but all pixels are the same!</span></span>
<span><span class="co"># Can you write reverse operation (height-to-width)?</span></span>
<span><span class="fu"><a href="../reference/rearrange.html">rearrange</a></span><span class="op">(</span><span class="va">ims</span>, <span class="st">"b h (w w2) c -&gt; (h w2) (b w) c"</span>, w2 <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="order-of-axes-matters">Order of axes matters<a class="anchor" aria-label="anchor" href="#order-of-axes-matters"></a>
</h2>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compare with the next example</span></span>
<span><span class="fu"><a href="../reference/rearrange.html">rearrange</a></span><span class="op">(</span><span class="va">ims</span>, <span class="st">"b h w c -&gt; h (b w) c"</span><span class="op">)</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># order of axes in composition is different</span></span>
<span><span class="co"># rule is just as for digits in the number: leftmost digit is the most significant,</span></span>
<span><span class="co"># while neighboring numbers differ in the rightmost axis.</span></span>
<span></span>
<span><span class="co"># you can also think of this as lexicographic sort</span></span>
<span><span class="fu"><a href="../reference/rearrange.html">rearrange</a></span><span class="op">(</span><span class="va">ims</span>, <span class="st">"b h w c -&gt; h (w b) c"</span><span class="op">)</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># what if b1 and b2 are reordered before composing to width?</span></span>
<span><span class="fu"><a href="../reference/rearrange.html">rearrange</a></span><span class="op">(</span><span class="va">ims</span>, <span class="st">"(b1 b2) h w c -&gt; h (b1 b2 w) c "</span>, b1<span class="op">=</span><span class="fl">2</span><span class="op">)</span>  <span class="co"># produces 'einops'</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rearrange.html">rearrange</a></span><span class="op">(</span><span class="va">ims</span>, <span class="st">"(b1 b2) h w c -&gt; h (b2 b1 w) c "</span>, b1<span class="op">=</span><span class="fl">2</span><span class="op">)</span>  <span class="co"># produces 'eoipns'</span></span></code></pre></div>
<p><img src="basics_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Qile Yang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
